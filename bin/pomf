#!/bin/bash
# scrot -> pomf.se, by @akibutts
# https://gist.github.com/aki--aki/6258422

SCROTARGS=()
DELETE=0
FILE=$1

# upload it and grab the URL
BASE=""; TRY=0
while [[ "x$BASE" == "x" ]] && [[ $TRY -lt 3 ]]; do
    TRY=$[$TRY + 1]
    echo "Uploading... (try $TRY)"
    JSON="`curl -sf -F "files[]=@$FILE" http://pomf.se/upload.php`"
    BASE="`echo "$JSON" | python -c "from __future__ import print_function;print(__import__('json').loads(__import__('sys').stdin.read())['files'][0]['url'])" 2>/dev/null`"
done

if [[ $TRY -eq 3 ]]; then
    echo "Giving up."
    exit 1
fi

URL="http://a.pomf.se/$BASE"

echo "$URL"

